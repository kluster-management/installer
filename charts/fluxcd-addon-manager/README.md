# FluxCD Manager

[FluxCD Manager](https://github.com/kluster-manager/fluxcd-addon) - Installs FluxCD in managed clusters

## TL;DR;

```bash
$ helm repo add appscode https://charts.appscode.com/stable
$ helm repo update
$ helm search repo appscode/fluxcd-addon-manager --version=0.1.0
$ helm upgrade -i fluxcd-addon-manager appscode/fluxcd-addon-manager -n open-cluster-management --create-namespace --version=0.1.0
```

## Introduction

This chart deploys a FluxCD Manager on a [Kubernetes](http://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.

## Prerequisites

- Kubernetes 1.21+

## Installing the Chart

To install/upgrade the chart with the release name `fluxcd-addon-manager`:

```bash
$ helm upgrade -i fluxcd-addon-manager appscode/fluxcd-addon-manager -n open-cluster-management --create-namespace --version=0.1.0
```

The command deploys a FluxCD Manager on the Kubernetes cluster in the default configuration. The [configuration](#configuration) section lists the parameters that can be configured during installation.

> **Tip**: List all releases using `helm list`

## Uninstalling the Chart

To uninstall the `fluxcd-addon-manager`:

```bash
$ helm uninstall fluxcd-addon-manager -n open-cluster-management
```

The command removes all the Kubernetes components associated with the chart and deletes the release.

## Configuration

The following table lists the configurable parameters of the `fluxcd-addon-manager` chart and their default values.

|                         Parameter                          |                                                                                                                                                     Description                                                                                                                                                      |                         Default                         |
|------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
| installCRDs                                                |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| multitenancy.enabled                                       | -- Implement the patches for Multi-tenancy lockdown. See https://fluxcd.io/docs/installation/#multi-tenancy-lockdown                                                                                                                                                                                                 | <code>false</code>                                      |
| multitenancy.defaultServiceAccount                         | -- All Kustomizations and HelmReleases which donât have spec.serviceAccountName specified, will use the default account from the tenantâs namespace. Tenants have to specify a service account in their Flux resources to be able to deploy workloads in their namespaces as the default account has no permissions. | <code>"default"</code>                                  |
| multitenancy.privileged                                    | -- Both kustomize-controller and helm-controller service accounts run privileged with cluster-admin ClusterRoleBinding. Disable if you want to run them with a minimum set of permissions.                                                                                                                           | <code>true</code>                                       |
| clusterDomain                                              |                                                                                                                                                                                                                                                                                                                      | <code>cluster.local</code>                              |
| cli.image                                                  |                                                                                                                                                                                                                                                                                                                      | <code>ghcr.io/fluxcd/flux-cli</code>                    |
| cli.tag                                                    |                                                                                                                                                                                                                                                                                                                      | <code>v2.1.1</code>                                     |
| cli.nodeSelector                                           |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| cli.affinity                                               |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| cli.tolerations                                            |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| cli.annotations                                            |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| cli.serviceAccount.automount                               |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| helmController.create                                      |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| helmController.image                                       |                                                                                                                                                                                                                                                                                                                      | <code>ghcr.io/fluxcd/helm-controller</code>             |
| helmController.tag                                         |                                                                                                                                                                                                                                                                                                                      | <code>v0.36.1</code>                                    |
| helmController.resources.limits                            |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| helmController.resources.requests.cpu                      |                                                                                                                                                                                                                                                                                                                      | <code>100m</code>                                       |
| helmController.resources.requests.memory                   |                                                                                                                                                                                                                                                                                                                      | <code>64Mi</code>                                       |
| helmController.priorityClassName                           |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| helmController.annotations.prometheus.io/port              |                                                                                                                                                                                                                                                                                                                      | <code>"8080"</code>                                     |
| helmController.annotations.prometheus.io/scrape            |                                                                                                                                                                                                                                                                                                                      | <code>"true"</code>                                     |
| helmController.labels.byte.builders/managed                |                                                                                                                                                                                                                                                                                                                      | <code>"true"</code>                                     |
| helmController.container.additionalArgs                    |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| helmController.extraEnv                                    |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| helmController.serviceAccount.create                       |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| helmController.serviceAccount.automount                    |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| helmController.serviceAccount.annotations                  |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| helmController.imagePullPolicy                             |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| helmController.nodeSelector                                |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| helmController.affinity                                    |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| helmController.tolerations                                 |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| imageAutomationController.create                           |                                                                                                                                                                                                                                                                                                                      | <code>false</code>                                      |
| imageAutomationController.image                            |                                                                                                                                                                                                                                                                                                                      | <code>ghcr.io/fluxcd/image-automation-controller</code> |
| imageAutomationController.tag                              |                                                                                                                                                                                                                                                                                                                      | <code>v0.36.1</code>                                    |
| imageAutomationController.resources.limits                 |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageAutomationController.resources.requests.cpu           |                                                                                                                                                                                                                                                                                                                      | <code>100m</code>                                       |
| imageAutomationController.resources.requests.memory        |                                                                                                                                                                                                                                                                                                                      | <code>64Mi</code>                                       |
| imageAutomationController.priorityClassName                |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| imageAutomationController.annotations.prometheus.io/port   |                                                                                                                                                                                                                                                                                                                      | <code>"8080"</code>                                     |
| imageAutomationController.annotations.prometheus.io/scrape |                                                                                                                                                                                                                                                                                                                      | <code>"true"</code>                                     |
| imageAutomationController.labels                           |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageAutomationController.container.additionalArgs         |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| imageAutomationController.extraEnv                         |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| imageAutomationController.serviceAccount.create            |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| imageAutomationController.serviceAccount.automount         |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| imageAutomationController.serviceAccount.annotations       |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageAutomationController.imagePullPolicy                  |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| imageAutomationController.nodeSelector                     |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageAutomationController.affinity                         |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageAutomationController.tolerations                      |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| imageReflectionController.create                           |                                                                                                                                                                                                                                                                                                                      | <code>false</code>                                      |
| imageReflectionController.image                            |                                                                                                                                                                                                                                                                                                                      | <code>ghcr.io/fluxcd/image-reflector-controller</code>  |
| imageReflectionController.tag                              |                                                                                                                                                                                                                                                                                                                      | <code>v0.30.0</code>                                    |
| imageReflectionController.resources.limits                 |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageReflectionController.resources.requests.cpu           |                                                                                                                                                                                                                                                                                                                      | <code>100m</code>                                       |
| imageReflectionController.resources.requests.memory        |                                                                                                                                                                                                                                                                                                                      | <code>64Mi</code>                                       |
| imageReflectionController.priorityClassName                |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| imageReflectionController.annotations.prometheus.io/port   |                                                                                                                                                                                                                                                                                                                      | <code>"8080"</code>                                     |
| imageReflectionController.annotations.prometheus.io/scrape |                                                                                                                                                                                                                                                                                                                      | <code>"true"</code>                                     |
| imageReflectionController.labels                           |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageReflectionController.container.additionalArgs         |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| imageReflectionController.extraEnv                         |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| imageReflectionController.serviceAccount.create            |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| imageReflectionController.serviceAccount.automount         |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| imageReflectionController.serviceAccount.annotations       |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageReflectionController.imagePullPolicy                  |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| imageReflectionController.nodeSelector                     |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageReflectionController.affinity                         |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| imageReflectionController.tolerations                      |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| kustomizeController.create                                 |                                                                                                                                                                                                                                                                                                                      | <code>false</code>                                      |
| kustomizeController.image                                  |                                                                                                                                                                                                                                                                                                                      | <code>ghcr.io/fluxcd/kustomize-controller</code>        |
| kustomizeController.tag                                    |                                                                                                                                                                                                                                                                                                                      | <code>v1.1.0</code>                                     |
| kustomizeController.resources.limits                       |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| kustomizeController.resources.requests.cpu                 |                                                                                                                                                                                                                                                                                                                      | <code>100m</code>                                       |
| kustomizeController.resources.requests.memory              |                                                                                                                                                                                                                                                                                                                      | <code>64Mi</code>                                       |
| kustomizeController.priorityClassName                      |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| kustomizeController.annotations.prometheus.io/port         |                                                                                                                                                                                                                                                                                                                      | <code>"8080"</code>                                     |
| kustomizeController.annotations.prometheus.io/scrape       |                                                                                                                                                                                                                                                                                                                      | <code>"true"</code>                                     |
| kustomizeController.labels                                 |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| kustomizeController.container.additionalArgs               |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| kustomizeController.extraEnv                               |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| kustomizeController.serviceAccount.create                  |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| kustomizeController.serviceAccount.automount               |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| kustomizeController.serviceAccount.annotations             |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| kustomizeController.imagePullPolicy                        |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| kustomizeController.secret.create                          | -- Create a secret to use it with extraSecretMounts. Defaults to false.                                                                                                                                                                                                                                              | <code>false</code>                                      |
| kustomizeController.secret.name                            |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| kustomizeController.secret.data                            |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| kustomizeController.envFrom.map.name                       |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| kustomizeController.envFrom.secret.name                    |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| kustomizeController.extraSecretMounts                      | -- Defines additional mounts with secrets. Secrets must be manually created in the namespace or with kustomizeController.secret                                                                                                                                                                                      | <code>[]</code>                                         |
| kustomizeController.nodeSelector                           |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| kustomizeController.affinity                               |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| kustomizeController.tolerations                            |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| notificationController.create                              |                                                                                                                                                                                                                                                                                                                      | <code>false</code>                                      |
| notificationController.image                               |                                                                                                                                                                                                                                                                                                                      | <code>ghcr.io/fluxcd/notification-controller</code>     |
| notificationController.tag                                 |                                                                                                                                                                                                                                                                                                                      | <code>v1.1.0</code>                                     |
| notificationController.resources.limits                    |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| notificationController.resources.requests.cpu              |                                                                                                                                                                                                                                                                                                                      | <code>100m</code>                                       |
| notificationController.resources.requests.memory           |                                                                                                                                                                                                                                                                                                                      | <code>64Mi</code>                                       |
| notificationController.priorityClassName                   |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| notificationController.annotations.prometheus.io/port      |                                                                                                                                                                                                                                                                                                                      | <code>"8080"</code>                                     |
| notificationController.annotations.prometheus.io/scrape    |                                                                                                                                                                                                                                                                                                                      | <code>"true"</code>                                     |
| notificationController.labels                              |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| notificationController.container.additionalArgs            |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| notificationController.extraEnv                            |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| notificationController.serviceAccount.create               |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| notificationController.serviceAccount.automount            |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| notificationController.serviceAccount.annotations          |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| notificationController.imagePullPolicy                     |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| notificationController.service.labels                      |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| notificationController.service.annotations                 |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| notificationController.webhookReceiver.service.labels      |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| notificationController.webhookReceiver.service.annotations |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| notificationController.nodeSelector                        |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| notificationController.affinity                            |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| notificationController.tolerations                         |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| sourceController.create                                    |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| sourceController.image                                     |                                                                                                                                                                                                                                                                                                                      | <code>ghcr.io/fluxcd/source-controller</code>           |
| sourceController.tag                                       |                                                                                                                                                                                                                                                                                                                      | <code>v1.1.1</code>                                     |
| sourceController.resources.limits                          |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| sourceController.resources.requests.cpu                    |                                                                                                                                                                                                                                                                                                                      | <code>100m</code>                                       |
| sourceController.resources.requests.memory                 |                                                                                                                                                                                                                                                                                                                      | <code>64Mi</code>                                       |
| sourceController.priorityClassName                         |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| sourceController.annotations.prometheus.io/port            |                                                                                                                                                                                                                                                                                                                      | <code>"8080"</code>                                     |
| sourceController.annotations.prometheus.io/scrape          |                                                                                                                                                                                                                                                                                                                      | <code>"true"</code>                                     |
| sourceController.labels.byte.builders/managed              |                                                                                                                                                                                                                                                                                                                      | <code>"true"</code>                                     |
| sourceController.container.additionalArgs                  |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| sourceController.serviceAccount.create                     |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| sourceController.serviceAccount.automount                  |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| sourceController.serviceAccount.annotations                |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| sourceController.imagePullPolicy                           |                                                                                                                                                                                                                                                                                                                      | <code>""</code>                                         |
| sourceController.service.labels                            |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| sourceController.service.annotations                       |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| sourceController.nodeSelector                              |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| sourceController.affinity                                  |                                                                                                                                                                                                                                                                                                                      | <code>{}</code>                                         |
| sourceController.tolerations                               |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| sourceController.extraEnv                                  |                                                                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| policies.create                                            |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| rbac.create                                                |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| rbac.createAggregation                                     | -- Grant the Kubernetes view, edit and admin roles access to Flux custom resources                                                                                                                                                                                                                                   | <code>true</code>                                       |
| logLevel                                                   |                                                                                                                                                                                                                                                                                                                      | <code>info</code>                                       |
| watchAllNamespaces                                         |                                                                                                                                                                                                                                                                                                                      | <code>true</code>                                       |
| imagePullSecrets                                           | -- contents of pod imagePullSecret in form 'name=[secretName]'; applied to all controllers                                                                                                                                                                                                                           | <code>[]</code>                                         |
| extraObjects                                               | -- Array of extra K8s agent-manifests to deploy                                                                                                                                                                                                                                                                      | <code>[]</code>                                         |
| prometheus.podMonitor.create                               | -- Enables podMonitor endpoint                                                                                                                                                                                                                                                                                       | <code>false</code>                                      |


Specify each parameter using the `--set key=value[,key=value]` argument to `helm upgrade -i`. For example:

```bash
$ helm upgrade -i fluxcd-addon-manager appscode/fluxcd-addon-manager -n open-cluster-management --create-namespace --version=0.1.0 --set multitenancy.defaultServiceAccount="default"
```

Alternatively, a YAML file that specifies the values for the parameters can be provided while
installing the chart. For example:

```bash
$ helm upgrade -i fluxcd-addon-manager appscode/fluxcd-addon-manager -n open-cluster-management --create-namespace --version=0.1.0 --values values.yaml
```
